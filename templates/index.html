<!doctype html>
<html lang="en" dir="ltr">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel = "stylesheet" href="static/css/style.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.rtl.min.css" integrity="sha384-Xbg45MqvDIk1e563NLpGEulpX6AvL404DP+/iCgW9eFa2BqztiwTexswJo2jLMue" crossorigin="anonymous">

    <title>Product Sales Predictor</title>
    <style>
    body {
      background-color: #f4f6f9;
    }
    .card {
      border-radius: 12px;
    }
    .card-header {
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    .btn-primary {
      font-size: 1.2rem;
      font-weight: bold;
    }
  </style>
  </head>

  <body>
<div class="container d-flex justify-content-center align-items-center min-vh-100">
  <div class="card w-100 shadow" style="max-width: 800px;">
    <div class="card-header text-center">
      <h1><i>Product Sales Predictor</i></h1>
    </div>
    
    <div class="card-body">
      <form method="post" accept-charset="utf-8">
        
        <div class="row">
          <!-- Column 1 -->
          <div class="col-md-6">
            <div class="mb-3">
              <label for="Product_ID" class="form-label"><b>Product ID</b></label>
              <select class="form-select" id="Product_ID" name="Product_ID" required>
                <option value="" disabled selected>Select Product ID</option>  
                {% for id in Item_Identifier %}
                    <option value="{{ id }}">{{ id }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <label for="Product_weight" class="form-label"><b>Product Weight</b></label>
              <input type="number" min="0" step="0.01" class="form-control" id="Product_weight" name="Product_weight" required placeholder="Enter Product Weight">
            </div>

            <div class="mb-3">
              <label for="Product_fat_content" class="form-label"><b>Fat Content</b></label>
              <select class="form-select" id="Product_fat_content" name="Product_fat_content" required>
                <option value="" disabled selected>Select Fat Content</option>  
                {% for fat_content in Item_Fat_Content %}
                    <option value="{{ fat_content }}">{{ fat_content }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <label for="Product_visibility" class="form-label"><b>Visibility</b></label>
              <input type="number" min="0" step="0.00001" max="1" class="form-control" id="Product_visibility" name="Product_visibility" required placeholder="Enter Visibility">
            </div>

            <div class="mb-3">
              <label for="Product_type" class="form-label"><b>Product Type</b></label>
              <select class="form-select" id="Product_type" name="Product_type" required>
                <option value="" disabled selected>Select Type</option>  
                {% for type in Item_Type %}
                    <option value="{{ type }}">{{ type }}</option>
                {% endfor %}
              </select>
            </div>
          </div>

          <!-- Column 2 -->
          <div class="col-md-6">
            <div class="mb-3">
              <label for="Product_MRP" class="form-label"><b>MRP</b></label>
              <input type="number" step="0.01" class="form-control" id="Product_MRP" name="Product_MRP" required placeholder="Enter MRP">
            </div>

            <div class="mb-3">
              <label for="Outlet_ID" class="form-label"><b>Outlet ID</b></label>
              <select class="form-select" id="Outlet_ID" name="Outlet_ID" required>
                <option value="" disabled selected>Select Outlet ID</option>  
                {% for id in Outlet_Identifier %}
                    <option value="{{ id }}">{{ id }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <label for="Outlet_Size" class="form-label"><b>Outlet Size</b></label>
              <select class="form-select" id="Outlet_Size" name="Outlet_Size" required>
                <option value="" disabled selected>Select Outlet Size</option>  
                {% for Size in Outlet_Size %}
                    <option value="{{ Size }}">{{ Size }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <label for="Outlet_Location_Type" class="form-label"><b>Location Type</b></label>
              <select class="form-select" id="Outlet_Location_Type" name="Outlet_Location_Type" required>
                <option value="" disabled selected>Select Location Type</option>  
                {% for Location_Type in Outlet_Location_Type %}
                    <option value="{{ Location_Type }}">{{ Location_Type }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <label for="Outlet_Type" class="form-label"><b>Outlet Type</b></label>
              <select class="form-select" id="Outlet_Type" name="Outlet_Type" required>
                <option value="" disabled selected>Select Outlet Type</option>  
                {% for type in Outlet_Type %}
                    <option value="{{ type }}">{{ type }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <div class="d-grid mt-4">
          <button class="btn btn-primary" onclick="send_data()">Predict Sales</button>
        </div>

      </form>
      <br>
        <div class="row">
          <div class="col-12" style="text-align: center;">
            <h3><span id="prediction"></span></h3>
          </div>
        </div>
    </div>
  </div>
</div>



  <script>

  function form_handler(event){
    event.preventDefault();
  }


  function send_data(){
    // suppress form default behaviour
    document.querySelector('form').addEventListener('submit',form_handler);

    var fd = new FormData(document.querySelector('form'));

    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/predict', true);
    document.getElementById("prediction").innerHTML = "Wait! we are predicting the Sales...";

    xhr.onreadystatechange = function(){
      if(xhr.readyState == XMLHttpRequest.DONE){
        //document.getElementById("prediction").innerHTML = "Prediction:- "+ xhr.responseText;
        try {
                let response = xhr.responseText;
                if (response.startsWith("ERROR:")) {
                    document.getElementById("prediction").innerHTML = "<span style='color:red;'>" + response + "</span>";
                } else {
                    document.getElementById("prediction").innerHTML = "Prediction: " + response;
                }
            } catch (e) {
                document.getElementById("prediction").innerHTML = "Server Error!";
            }
      }
    }

    xhr.onload = function(){};
    xhr.send(fd);
  }
/*
  function send_data(event) {
    // Stop form from submitting normally
    event.preventDefault();

    var fd = new FormData(document.querySelector('form'));

    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/predict', true);

    document.getElementById("prediction").innerHTML = "Wait! We are predicting the Sales...";

    xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            try {
                const response = JSON.parse(xhr.responseText);
                if (response.error) {
                    document.getElementById("prediction").innerHTML = "<span style='color:red;'>" + response.error + "</span>";
                } else {
                    document.getElementById("prediction").innerHTML = "Prediction: â‚¹" + response.prediction;
                }
            } catch (e) {
                document.getElementById("prediction").innerHTML = "Server Error!";
            }
        }
    };

    xhr.send(fd);
} */


</script> 
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>